


<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCR3AaHzI1-N6CK-i11OeSTKH7ipkIzlzE&sensor=true"></script>


<script type="text/javascript">

var directionsDisplay;
var directionsService = new google.maps.DirectionsService();
var map;


function initialize() {
  
  //武蔵中原
  var musa_lat = 35.581154;
  var musa_lon = 139.641474;
  var musa_latlng = new google.maps.LatLng(<%=@p_lat%>,<%=@p_lon %>);

  var umbrella = <%= raw @umbrella %>;


  //マップオプション
  var myOptions = {
    zoom: 16,
    center: musa_latlng,
    mapTypeId: google.maps.MapTypeId.ROADMAP
  };

  //マップ出力
  map = new google.maps.Map(document.getElementById('map_canvas'), myOptions);

  //傘設置

  setUmbrella(umbrella);
  
  
  //クリックイベント取得
  google.maps.event.addListener(map, 'click', function(event) {
      placeMarker(event.latLng);
  });

  //経路オブジェクト
  directionsDisplay = new google.maps.DirectionsRenderer();
  // directionsDisplay.setMap(map);

}

function setUmbrella(umbrella){
  for (var i = 0; i < umbrella.length; i++) {
    var latLng = new google.maps.LatLng(umbrella[i].gps_lat,umbrella[i].gps_lon);
    var marker = new google.maps.Marker({
      position: latLng,
      map: map,
      animation: google.maps.Animation.DROP,
      icon: "<%= @img %>"
    })


  }
}


function placeMarker(location) {
  var image = "<%= @img %>";
  var marker = new google.maps.Marker({
      position: location,
      map: map,
      animation: google.maps.Animation.DROP,
      icon: image
  }); 

  //map.setCenter(location);
}

function setInfoWindow(location){
  var infowindow = new google.maps.InfoWindow({
    content: 'Change the zoom level',
    position: location
  });
  infowindow.open(map); 
}

</script>



<!-- マップキャンパス -->
<div class="container">
  <div class="row">
	<div id="map_canvas" style="width:100%;height:800px;margin-bottom:20px;"></div>
  </div>
</div>







<div onload="initialize();"></div>



<script>
$(function() {
  //HTML的にonload属性に対応している要素名の配列
  var STD_ONLOAD_TAGS = [
        'BODY', 'APPLET', 'EMBED', 'FRAMESET',
        'IMG', 'LINK', 'SCRIPT', 'STYLE'];
  //onload属性がつけられた要素を選択
  $('[onload]').each(function(){
    //もともとonload属性が無い要素だけを処理する。
    if($.inArray(this.tagName, STD_ONLOAD_TAGS) < 0) {
      //onloadハンドラを取り出す
      var f = $(this).attr('onload');
      //タイプがfunctionならそのまま呼び出す。そうでないなら
      //文字列と仮定してevalする無名関数を定義して呼び出す。
      if(typeof(f) == 'function') {
        f.call(this);
      } else {
        (function() {eval(f);}).call(this);
      }
    }
  });
});

</script>
